var u=Object.defineProperty;var g=(s,e,t)=>e in s?u(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var c=(s,e,t)=>g(s,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();class p{constructor(){c(this,"googlePhotosAPIEndpoint","https://photoslibrary.googleapis.com/v1")}async upload(e,t){const r=new Headers({Authorization:`Bearer ${t}`,"Content-Type":"application/octet-stream","X-Goog-Upload-Content-Type":e.type,"X-Goog-Upload-Protocol":"raw"}),o=await fetch(`${this.googlePhotosAPIEndpoint}/uploads`,{method:"POST",headers:r,body:e});if(!o.ok)throw new Error(`Upload failed with status: ${o.status}`);return await o.text()}async createAlbum(e){const t="snack_saver",r=new Headers({Authorization:`Bearer ${e}`}),o={album:{title:t}},n=await fetch(`${this.googlePhotosAPIEndpoint}/albums`,{method:"POST",headers:r,body:JSON.stringify(o)});if(!n.ok)throw new Error(`Upload failed with status: ${n.status}`);const a=await n.json();return a.id?console.log(`Album "${t}" created with ID: ${a.id}`):console.error("Failed to create album:",a),a}}class h{constructor(){c(this,"client")}setAccessToken(e,t){localStorage.setItem("google_oauth_token",e),localStorage.setItem("google_oauth_token_expiration",(Date.now()+t*1e3).toString())}getAccessToken(){return localStorage.getItem("accessToken")??""}isTokenExpired(){const e=localStorage.getItem("google_oauth_token_expiration");return e?Date.now()>=parseInt(e):!0}init(){return new Promise(e=>{this.client=window.google.accounts.oauth2.initTokenClient({client_id:"397214112278-cqkkgppbq08odlaoa7lglrf29evon1jd.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/photoslibrary.appendonly",callback:async t=>{console.log("Login Success",t),this.setAccessToken(t.access_token,t.expires_in),e()}})})}login(){this.client||this.init(),this.isTokenExpired()?this.client.requestAccessToken():console.log("already logged in")}}const i=document.querySelector("#camera-input"),l=document.querySelector("#camera-image"),d=new h,f=new p;i&&(l==null||l.addEventListener("click",()=>{i==null||i.click()}),i.addEventListener("change",async s=>{const e=s.target,t=e.files?e.files[0]:null;if(t)try{const r=d.getAccessToken(),o=await f.upload(t,r);console.log("Upload successful, upload token:",o)}catch(r){console.error("Error uploading image:",r)}}));window.onload=async function(){d.login()};
